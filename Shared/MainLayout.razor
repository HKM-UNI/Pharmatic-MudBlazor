@using MudBlazor.Services
@inherits LayoutComponentBase
@inject NavigationManager _navigationManager
@inject SharedData _data
@using static CustomIcons
@using Pharmatic.Services
<link rel="stylesheet" href="/css/background.css?version=6" />

<MudThemeProvider Theme="selectedTheme" />
<MudSnackbarProvider />
<MudDialogProvider FullWidth="true"
                   DisableBackdropClick="true"
                   Position="DialogPosition.Center"
                   CloseOnEscapeKey="true" />

<MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Class="mt-3">
    <MudGrid Style="height:100vh;">

        <MudBreakpointProvider>
            <MudHidden Breakpoint="Breakpoint.MdAndDown">
                <MudItem md="2" Style="height:100%">
                    <MudPaper Class="d-flex flex-column gap-4"
                              Elevation="0"
                              Style="background-color: white; height:100%">

                        <DrawerContent />

                    </MudPaper>
                </MudItem>
            </MudHidden>
        </MudBreakpointProvider>

        <MudItem lg="10" md="12" Style="height:100%">

            <MudPaper Class="d-flex flex-column gap-4" Elevation="0" 
                    Style="background-color: rgba(231, 255, 255, 0.4); height:100%;">
                <MudAppBar Elevation="0" Fixed="false" Style="border-radius: 15px;" Dense="true">

                    <MudBreakpointProvider>
                        <MudHidden Breakpoint="Breakpoint.LgAndUp">
                            <MudIconButton Icon="@CustomIcons.Menu" Color="Color.Primary"
                                OnClick="OpenDrawer" Size="Size.Medium"/>
                        </MudHidden>
                    </MudBreakpointProvider>

                    <MudBreadcrumbs Items="_data.Items" Separator=">"/>

                    <MudSpacer />

                    <MudIconButton Icon="@CustomIcons.Notification" Color="Color.Inherit" OnClick="CerrarSesion" Size="Size.Medium" />

                    <MudMenu PositionAtCursor="true">
                        <ActivatorContent>
                            <MudCard Style="background: inherit;" Elevation="0" Class="hover-card2">

                                <MudCardHeader>
                                    <CardHeaderAvatar>
                                        <MudAvatar Color="Color.Secondary" Size="Size.Medium">R</MudAvatar>
                                    </CardHeaderAvatar>

                                    <CardHeaderContent>
                                        <MudBreakpointProvider>
                                            <MudHidden Breakpoint="Breakpoint.MdAndDown">
                                                <MudText Typo="Typo.body2">Ricardo Montenegro</MudText>
                                                <MudText Typo="Typo.body2">Tonny.n1105@gmail.com</MudText>
                                            </MudHidden>
                                        </MudBreakpointProvider>
                                        
                                    </CardHeaderContent>

                                </MudCardHeader>
                            </MudCard>
                        </ActivatorContent>

                        <ChildContent>
                            <MudMenuItem>Profile</MudMenuItem>
                            <MudMenuItem>My account</MudMenuItem>
                            <MudMenuItem OnClick="CerrarSesion">Logout</MudMenuItem>
                        </ChildContent>
                    </MudMenu>

                </MudAppBar>

                <MudMainContent Class="pa-0" Style="border-radius: 15px; height: calc(100% - 90px);">
                    @Body
                </MudMainContent>
            </MudPaper>

        </MudItem>

    </MudGrid>  
</MudContainer>

<MudDrawer @bind-Open="@open" Elevation="1" Variant="@DrawerVariant.Temporary">
    <DrawerContent/>
</MudDrawer>
    
@code {
    private MudTheme selectedTheme = CustomThemes.PharmaticThemeRounded;
    string search_text = string.Empty;
    bool open;

    protected override void OnInitialized()
    {

        _data.Items = new List<BreadcrumbItem>
        {
            new BreadcrumbItem("Home", href: "/dashboard", icon: Icons.Material.Filled.Home, disabled:true)
        };
    }

    private void CerrarSesion()
    {
        _navigationManager.NavigateTo("/");
    }

    void OpenDrawer() => open = true;
    
}