@page "/"
@inject NavigationManager _navigationManager
@layout LoginLayout


<MudPaper Class="pa-4 d-flex align-content-space-between" Elevation="0" Square="true" Height="100%">
    <EditForm Model="@loginUser" OnValidSubmit="OnValidSubmit">
        <MudImage Fluid="true" Src="/img/PharmaticLogo.png" />

        <DataAnnotationsValidator></DataAnnotationsValidator>

        <MudText Typo="Typo.h4" GutterBottom="true" Align="Align.Left" Class="ml-8">Login</MudText>

        <MudTextField T="string"
            @bind-Value="@loginUser.Email"
                          Label="Correo"
                          Variant="Variant.Outlined"
                          Class="my-6"
                          For="@(() => loginUser.Email)"
                          Margin="Margin.Dense">
        </MudTextField>

        <MudTextField @bind-Value="@loginUser.Password"
            Label="Contraseña"
            Variant="Variant.Outlined"
            InputType="@PasswordInput"
            Adornment="Adornment.End"
            AdornmentIcon="@PasswordInputIcon"
            OnAdornmentClick="TogglePasswordVisibility"
            For="@(() => loginUser.Password)"
            Margin="Margin.Dense" />

        <MudCheckBox @bind-Checked="@checkvalue" Color="@Color.Primary" Label="Mantener Sesión" />

        <center>
            <MudButton Class="mt-5 btn rounded-pill" Variant="Variant.Filled" ButtonType="ButtonType.Submit" Size="Size.Large"
                    Disabled="@disableButton" Color="Color.Primary">
                Iniciar Sesión
            </MudButton>
        </center>

        <center>
            <MudButton Variant="Variant.Text" Color="Color.Primary" Class="ma-4">¿Tienes problemas?</MudButton>
        </center>
        <MudProgressLinear Color="Color.Primary" Indeterminate="loading" Class="object-bottom"/>
    </EditForm>
</MudPaper>

<MudAlert Severity="Severity.Error" Class="@(myAlert + " mt-8 mud-width-full")" Style="max-width:500px;" Elevation="25">No se encontraron coincidencias</MudAlert>

@code {
    LoginUser loginUser = new LoginUser();
    string myImageClass { get; set; } = "d-none";
    string myAlert { get; set; } = "d-none";
    bool disableButton { get; set; } = false;
    public bool? checkvalue { get; set; } = false;


    bool loading = false;

    bool PasswordVisibility;
    InputType PasswordInput = InputType.Password;
    string PasswordInputIcon = Icons.Material.Filled.VisibilityOff;

    void TogglePasswordVisibility()
    {
        @if (PasswordVisibility)
        {
            PasswordVisibility = false;
            PasswordInputIcon = Icons.Material.Filled.VisibilityOff;
            PasswordInput = InputType.Password;
        }
        else
        {
            PasswordVisibility = true;
            PasswordInputIcon = Icons.Material.Filled.Visibility;
            PasswordInput = InputType.Text;
        }
    }

    private async Task OnValidSubmit()
    {
        myImageClass = "d-block";
        disableButton = true;
        var result = true;

        if (result)
        {
            loading = true;
            await Task.Delay(2000);
            _navigationManager.NavigateTo("/dashboard");
        }   
        else
        {
            myImageClass = "d-none";
            disableButton = false;
            myAlert = "d-block";
        }
    }
}
